<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kantor Lab Chatbot - Automatisch deployt</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            height: 100%;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: transparent;
            min-height: 100vh;
            position: relative;
        }

        /* CHAT WIDGET BUTTON */
        .chat-widget-button {
            position: fixed !important;
            bottom: 24px !important;
            right: 24px !important;
            top: auto !important;
            left: auto !important;
            width: 72px;
            height: 72px;
            background: #B7483E;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(183, 72, 62, 0.25);
            transition: all 0.3s ease;
            z-index: 1000;
            padding-top: 2px;
        }

        .chat-widget-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(183, 72, 62, 0.35);
        }

        .notification-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 16px;
            height: 16px;
            background: #ef4444;
            border: 3px solid #ffffff;
            border-radius: 50%;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease;
        }

        .notification-badge.show {
            opacity: 1;
            transform: scale(1);
            animation: pulseBadge 2s ease-in-out infinite;
        }

        @keyframes pulseBadge {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .chat-icon {
            width: 48px;
            height: 48px;
            transition: all 0.3s ease;
            opacity: 1;
            transform: scale(1) rotate(0deg);
        }

        .chat-widget-button.open .chat-icon {
            opacity: 0;
            transform: scale(0) rotate(90deg);
        }

        .close-icon {
            position: absolute;
            width: 32px;
            height: 32px;
            opacity: 0;
            transform: scale(0) rotate(-90deg);
            transition: all 0.3s ease;
        }

        .chat-widget-button.open .close-icon {
            opacity: 1;
            transform: scale(1) rotate(0deg);
        }

        .close-icon line {
            stroke: white;
            stroke-width: 2.5;
            stroke-linecap: round;
        }

        .chat-widget-button.clicked::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid #B7483E;
            animation: pulseRipple 0.6s ease-out;
        }

        @keyframes pulseRipple {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.8;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0;
            }
        }

        /* POP-UP MESSAGE - KEIN SCHIMMER */
        .popup-message {
            position: fixed !important;
            bottom: 130px !important;
            right: 24px !important;
            top: auto !important;
            left: auto !important;
            width: 320px;
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            padding: 20px;
            padding-bottom: 32px;
            opacity: 0;
            transform: translateY(10px) scale(0.95);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
            z-index: 998;
        }

        .popup-message.show {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: all;
        }

        .popup-arrow {
            position: absolute;
            bottom: -10px;
            right: 24px;
            width: 24px;
            height: 24px;
        }

        .popup-arrow::before {
            content: '';
            position: absolute;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%) rotate(45deg);
            width: 22px;
            height: 22px;
            background: #ffffff;
            border-radius: 0 0 4px 0;
        }

        .popup-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
            color: #9ca3af;
        }

        .popup-close:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .popup-close svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
        }

        .popup-content {
            padding-right: 24px;
        }

        .popup-header {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px;
        }

        .popup-badge {
            font-size: 12px;
            font-weight: 600;
            color: #B7483E;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            filter: brightness(1.1) saturate(1.2);
            text-shadow: 0 0 8px rgba(183, 72, 62, 0.3);
        }

        .spark-icon {
            width: 14px;
            height: 14px;
            filter: drop-shadow(0 0 4px rgba(183, 72, 62, 0.4));
        }

        .popup-title {
            font-size: 16px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 4px;
            line-height: 1.4;
            white-space: nowrap;
        }

        .popup-subtitle {
            font-size: 12px;
            color: #6b7280;
            opacity: 0.7;
            margin-bottom: 20px;
            font-weight: 400;
        }

        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .quick-action-btn {
            background: #f9fafb;
            border: none;
            border-radius: 10px;
            padding: 14px 16px;
            font-size: 13px;
            color: #374151;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            font-weight: 500;
            width: fit-content;
        }

        .quick-action-btn:hover {
            background: #f3f4f6;
            color: #B7483E;
            transform: translateY(-1px);
        }

        /* CHATBOT CONTAINER */
        .chatbot-container {
            position: fixed !important;
            bottom: 130px !important;
            right: 24px !important;
            top: auto !important;
            left: auto !important;
            width: 450px;
            height: 680px;
            background: #ffffff;
            border-radius: 28px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 999;
            transition: height 0.4s cubic-bezier(0.34, 1.56, 0.64, 1),
                        opacity 0.4s cubic-bezier(0.34, 1.56, 0.64, 1),
                        transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            opacity: 0;
            transform: translateY(30px) scale(0.9);
            pointer-events: none;
            visibility: hidden;
        }

        .chatbot-container.open {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: all;
            visibility: visible;
        }

        .chatbot-container.expanded {
            height: 800px;
        }

        .chatbot-header {
            padding: 20px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-container {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: #B7483E;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .status-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: #10b981;
            border: 2.5px solid #ffffff;
            border-radius: 50%;
        }

        .header-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .company-name {
            font-size: 13px;
            font-weight: 500;
            color: #111827;
            opacity: 0.7;
        }

        .chatbot-name {
            font-size: 16px;
            color: #111827;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .icon-button {
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            color: #6b7280;
        }

        .icon-button:hover {
            background: #f3f4f6;
            color: #111827;
        }

        .icon-button svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        /* Nur das Close-Icon (X) soll 24px sein */
        .icon-button:last-child svg {
            width: 24px;
            height: 24px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px 24px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            max-width: 90%;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Slide-in Animation für Bot-Nachrichten */
        .message.slide-in {
            animation: slideInFromBottom 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes slideInFromBottom {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Fade-in Animation für Typing Indicator */
        #typing-indicator {
            animation: fadeIn 0.3s ease;
            min-height: 52px; /* Verhindert Layout-Shift */
        }

        #typing-indicator.fade-out {
            animation: fadeOut 0.3s ease forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: scale(1);
            }
            to {
                opacity: 0;
                transform: scale(0.95);
            }
        }

        /* Gruppierte Bot-Nachrichten (innerhalb 10 Sek) haben kleineren Abstand */
        .message.bot.grouped {
            margin-top: -8px;
        }

        /* Frühere Nachrichten in einer Gruppe verstecken Avatar und Timestamp */
        .message.bot.grouped-previous .message-avatar {
            visibility: hidden;
        }

        .message.bot.grouped-previous .message-timestamp {
            display: none;
        }

        .message-timestamp {
            font-size: 11px;
            color: #9ca3af;
            opacity: 0.6;
            margin-top: 5px;
            text-align: right;
            font-weight: 400;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .message.bot .message-timestamp {
            text-align: left;
            justify-content: flex-start;
        }

        .message.user .message-timestamp {
            justify-content: flex-end;
        }

        .feedback-buttons {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .feedback-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 2px;
            opacity: 0.5;
            transition: opacity 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .feedback-btn:hover {
            opacity: 1;
        }

        .feedback-btn svg {
            width: 14px;
            height: 14px;
            fill: #9ca3af;
        }

        .feedback-separator {
            color: #9ca3af;
            opacity: 0.6;
            margin: 0 2px;
        }

        .message.user {
            margin-left: auto;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #B7483E;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-bottom: 26px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .message-avatar svg {
            width: 18px;
            height: 18px;
            transform: scale(1.1);
        }

        .message.user .message-avatar {
            display: none;
        }

        .message-content {
            background: #f9fafb;
            padding: 14px 16px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.5;
            color: #374151;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .message.user .message-content {
            background: rgba(183, 72, 62, 0.12);
            color: #7C2F28;
        }

        /* Quick Actions im Chat */
        .quick-actions-message {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 16px;
        }

        .quick-action-chat-btn {
            background: #f3f4f6;
            border: none;
            border-radius: 12px;
            padding: 14px 18px;
            font-size: 13px;
            color: #374151;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            font-weight: 500;
        }

        .quick-action-chat-btn:hover {
            background: #e5e7eb;
            color: #B7483E;
            transform: translateY(-1px);
        }

        /* Booking Form */
        .booking-form {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 16px;
        }

        .booking-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            background: #ffffff;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .booking-input:focus {
            outline: none;
            border-color: #B7483E;
            box-shadow: 0 4px 32px rgba(183, 72, 62, 0.15),
                        0 0 0 3px rgba(183, 72, 62, 0.1);
        }

        .booking-input:disabled {
            background: #f3f4f6;
            color: #9ca3af;
            cursor: not-allowed;
        }

        .booking-input.error {
            border-color: #ef4444;
        }

        .privacy-checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #6b7280;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .privacy-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            flex-shrink: 0;
            accent-color: #B7483E;
        }

        .privacy-checkbox-label {
            cursor: pointer;
            user-select: none;
            line-height: 1.4;
        }

        .privacy-checkbox-label a {
            color: #B7483E;
            text-decoration: none;
        }

        .privacy-checkbox-label a:hover {
            text-decoration: underline;
        }

        .booking-submit {
            width: 100%;
            padding: 12px 16px;
            background: #B7483E;
            color: #ffffff;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 1;
            max-height: 48px;
            overflow: hidden;
        }

        .booking-submit:hover {
            background: #9d3a32;
            transform: translateY(-1px);
        }

        .booking-submit:active {
            transform: translateY(0);
        }

        .booking-submit:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            transform: none;
        }

        .booking-submit.hide {
            opacity: 0;
            max-height: 0;
            padding: 0;
            margin: 0;
        }

        .booking-form.submitted {
            gap: 4px;
        }

        /* Contact Form Container */
        .contact-form-container {
            position: fixed !important;
            bottom: 130px !important;
            right: 24px !important;
            top: auto !important;
            left: auto !important;
            width: 450px;
            height: 680px;
            background: #ffffff;
            border-radius: 28px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 999;
            transition: opacity 0.4s cubic-bezier(0.34, 1.56, 0.64, 1),
                        transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            opacity: 0;
            transform: translateY(30px) scale(0.9);
            pointer-events: none;
            visibility: hidden;
        }

        .contact-form-container.open {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: all;
            visibility: visible;
        }

        .contact-form-content {
            flex: 1;
            overflow-y: visible;
            padding: 24px;
        }

        .contact-form-inner {
            max-width: 100%;
        }

        .contact-form-title {
            font-size: 20px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 8px;
        }

        .contact-form-description {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .contact-form-fields {
            display: flex;
            flex-direction: column;
            gap: 28px;
        }

        .contact-form-fields .booking-submit {
            margin-bottom: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0px;
        }

        .form-label {
            font-size: 13px;
            font-weight: 500;
            color: #374151;
        }

        .contact-textarea {
            resize: none;
            height: 120px;
            overflow-y: auto;
            font-family: inherit;
        }

        .form-group .error-message {
            margin-top: 8px;
            margin-bottom: -24px;
        }

        #contactPrivacyError {
            margin-top: -20px;
            margin-bottom: 0;
        }

        .contact-form-fields .privacy-checkbox-wrapper {
            margin-top: -8px;
            margin-bottom: -4px;
        }

        /* Contact Handover Button */
        .contact-handover-btn {
            width: 100%;
            padding: 12px 16px;
            background: #B7483E;
            color: #ffffff;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 16px;
            opacity: 1;
            max-height: 48px;
            overflow: hidden;
        }

        .contact-handover-btn:hover {
            background: #9d3a32;
            transform: translateY(-1px);
        }

        .contact-handover-btn:active {
            transform: translateY(0);
        }

        .contact-handover-btn svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2.5;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .contact-handover-btn.hide {
            opacity: 0;
            max-height: 0;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }

        .error-message {
            font-size: 12px;
            color: #ef4444;
            margin-top: -8px;
        }

        /* Loading Animation */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 8px 12px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #9ca3af;
            animation: typingDot 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingDot {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        /* Final Feedback Message */
        .feedback-message {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 16px;
            margin: 16px 0;
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .feedback-message.hiding {
            opacity: 0;
            transform: scale(0.95);
        }

        .feedback-message-title {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 6px;
        }

        .feedback-message-subtitle {
            font-size: 12px;
            color: #9ca3af;
            margin-bottom: 16px;
        }

        .feedback-buttons {
            display: flex;
            gap: 12px;
        }

        .feedback-response-btn {
            padding: 10px 24px;
            background: #f3f4f6;
            border: none;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .feedback-response-btn:hover {
            background: #e5e7eb;
            transform: translateY(-1px);
        }

        .feedback-response-btn:active {
            transform: translateY(0);
        }

        .feedback-response-btn svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2.5;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .date-divider {
            display: flex;
            align-items: center;
            gap: 12px;
            text-align: center;
            font-size: 11px;
            color: #9ca3af;
            opacity: 0.6;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .date-divider::before,
        .date-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(to right, rgba(156, 163, 175, 0) 0%, rgba(156, 163, 175, 0.6) 50%, rgba(156, 163, 175, 0) 100%);
        }

        .date-divider::before {
            background: linear-gradient(to left, rgba(156, 163, 175, 0.6) 50%, rgba(156, 163, 175, 0) 100%);
        }

        .date-divider::after {
            background: linear-gradient(to right, rgba(156, 163, 175, 0.6) 50%, rgba(156, 163, 175, 0) 100%);
        }

        .chat-input-area {
            padding: 16px 20px;
            background: #ffffff;
        }

        .input-wrapper {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: none;
            background: #f9fafb;
            border-radius: 24px;
            font-size: 14px;
            font-family: inherit;
            resize: none;
            min-height: 44px;
            max-height: 120px;
            box-shadow: none;
            transition: box-shadow 0.3s ease;
        }

        .chat-input:hover {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        .chat-input:focus {
            outline: none;
            box-shadow: 0 4px 20px rgba(183, 72, 62, 0.15),
                        0 0 0 3px rgba(183, 72, 62, 0.1);
        }

        .send-button {
            width: 40px;
            height: 40px;
            background: #f9fafb;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .send-button:hover {
            background: #f3f4f6;
            transform: scale(1.05);
        }

        .send-button svg {
            width: 20px;
            height: 20px;
            stroke: #6b7280;
            fill: none;
            stroke-width: 2;
        }

        .privacy-notice {
            font-size: 11px;
            color: #9ca3af;
            text-align: center;
            margin-top: 12px;
        }

        .privacy-notice a {
            color: #B7483E;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <button class="chat-widget-button" id="chatButton" onclick="toggleChat()">
        <div class="notification-badge" id="notificationBadge"></div>
        
        <svg class="chat-icon" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                <path d="M 20 25 Q 20 25, 20.8 25.8 L 26 32 Q 26.5 32.5, 27 32 L 32.2 25.8 Q 33 25, 33 25 Z"
                      fill="white" stroke="white" stroke-width="0"/>
                <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
            </g>
        </svg>
        
        <svg class="close-icon" viewBox="0 0 24 24">
            <line x1="6" y1="6" x2="18" y2="18"/>
            <line x1="18" y1="6" x2="6" y2="18"/>
        </svg>
    </button>

    <div class="popup-message" id="popupMessage">
        <div class="popup-arrow"></div>
        <button class="popup-close" onclick="closePopup()">
            <svg viewBox="0 0 24 24">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        </button>
        <div class="popup-content">
            <div class="popup-header">
                <div class="popup-badge">
                    <svg class="spark-icon" viewBox="0 0 24 24" fill="#B7483E">
                        <path d="M12 2L9 9L2 12L9 15L12 22L15 15L22 12L15 9L12 2Z"/>
                    </svg>
                    Support Assistant
                </div>
            </div>
            <div class="popup-title">Ich helfe Ihnen gerne weiter!</div>
            <div class="popup-subtitle">Wollen Sie möglicherweise?</div>
            <div class="quick-actions">
                <button class="quick-action-btn" onclick="selectQuickAction('termin')">
                    Termin vereinbaren
                </button>
                <button class="quick-action-btn" onclick="selectQuickAction('kontakt')">
                    Ich will Kontakt aufnehmen.
                </button>
                <button class="quick-action-btn" onclick="selectQuickAction('angebot')">
                    Was bietet Ihr genau an?
                </button>
            </div>
        </div>
    </div>

    <div class="chatbot-container" id="chatContainer">
        <div class="chatbot-header">
            <div class="header-left">
                <div class="logo-container">
                    <div class="status-indicator"></div>
                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                            <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                            <path d="M 19 26 Q 19 26, 19.8 26.8 L 24 31 Q 24.5 31.5, 25 31 L 29.2 26.8 Q 30 26, 30 26 Z" 
                                  fill="white" stroke="white" stroke-width="0"/>
                            <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                            <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
                        </g>
                    </svg>
                </div>
                <div class="header-info">
                    <div class="company-name">kantor lab.</div>
                    <div class="chatbot-name">Support Assistant</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="icon-button" onclick="toggleExpand()" title="Erweitern">
                    <svg viewBox="0 0 24 24">
                        <polyline points="15 3 21 3 21 9"/>
                        <polyline points="9 21 3 21 3 15"/>
                        <line x1="21" y1="3" x2="14" y2="10"/>
                        <line x1="3" y1="21" x2="10" y2="14"/>
                    </svg>
                </button>
                <button class="icon-button" onclick="toggleChat()" title="Schließen">
                    <svg viewBox="0 0 24 24">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="date-divider" id="dateDisplay"></div>
            
            <div class="message bot">
                <div class="message-avatar">
                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                            <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                            <path d="M 20 25 Q 20 25, 20.8 25.8 L 26 32 Q 26.5 32.5, 27 32 L 32.2 25.8 Q 33 25, 33 25 Z"
                                  fill="white" stroke="white" stroke-width="0"/>
                            <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                            <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
                        </g>
                    </svg>
                </div>
                <div>
                    <div class="message-content">
                        Hallo! Wie kann ich Ihnen heute helfen?
                    </div>
                </div>
            </div>

            <div class="message user">
                <div>
                    <div class="message-content">
                        Ich möchte einen Termin buchen.
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-input-area">
            <div class="input-wrapper">
                <textarea 
                    id="messageInput" 
                    class="chat-input" 
                    placeholder="Schreiben Sie eine Nachricht..."
                    rows="1"
                ></textarea>
                <button class="send-button" onclick="sendMessage()">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 19V5M5 12l7-7 7 7" stroke="#6b7280" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div class="privacy-notice">
                Mit dem Senden akzeptieren Sie unsere <a href="#">Datenschutz</a>
            </div>
        </div>
    </div>

    <!-- Contact Form Container -->
    <div class="contact-form-container" id="contactFormContainer">
        <div class="chatbot-header">
            <div class="header-left">
                <button class="icon-button" onclick="closeContactForm()" title="Zurück">
                    <svg viewBox="0 0 24 24">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                </button>
                <div class="header-info">
                    <div class="company-name">kantor lab.</div>
                    <div class="chatbot-name">Kontaktformular</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="icon-button" onclick="toggleChat()" title="Schließen">
                    <svg viewBox="0 0 24 24">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        </div>

        <div class="contact-form-content">
            <div class="contact-form-inner">
                <h2 class="contact-form-title">Kontaktieren Sie uns 👋</h2>
                <p class="contact-form-description">Füllen Sie das Formular aus und unser Team wird sich schnellstmöglich bei Ihnen melden.</p>
                <p class="contact-form-description" style="margin-top: 12px;">Oder schreiben Sie eine Mail an <span style="color: #B7483E; font-weight: 600;">info@prime-marketing.com</span></p>

                <form class="contact-form-fields" id="contactFormFields">
                    <div class="form-group">
                        <input type="text" class="booking-input" id="contactName" placeholder="Name">
                        <div class="error-message" id="contactNameError" style="display: none;">Bitte geben Sie einen gültigen Namen ein (mind. 2 Zeichen)</div>
                    </div>

                    <div class="form-group">
                        <input type="email" class="booking-input" id="contactEmail" placeholder="ihre@mail.de">
                        <div class="error-message" id="contactEmailError" style="display: none;">Bitte geben Sie eine gültige E-Mail-Adresse ein</div>
                    </div>

                    <div class="form-group">
                        <textarea class="booking-input contact-textarea" id="contactMessage" placeholder="Ihre Nachricht..."></textarea>
                        <div class="error-message" id="contactMessageError" style="display: none;">Bitte geben Sie eine Nachricht ein (mind. 10 Zeichen)</div>
                    </div>

                    <div class="privacy-checkbox-wrapper">
                        <input type="checkbox" class="privacy-checkbox" id="contactPrivacyCheckbox">
                        <label for="contactPrivacyCheckbox" class="privacy-checkbox-label">
                            Ich akzeptiere die <a href="#" onclick="event.preventDefault()">Datenschutzerklärung</a>
                        </label>
                    </div>
                    <div class="error-message" id="contactPrivacyError" style="display: none;">Bitte akzeptieren Sie die Datenschutzerklärung</div>

                    <button type="button" class="booking-submit" id="contactSubmitBtn" onclick="submitContactForm()">Nachricht senden</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Aktuelles Datum anzeigen (ohne Jahr)
        function displayCurrentDate() {
            const dateDiv = document.getElementById('dateDisplay');
            const today = new Date();
            const options = { weekday: 'long', month: 'long', day: 'numeric' };
            const dateString = today.toLocaleDateString('de-DE', options);
            dateDiv.textContent = dateString;
        }

        // Uhrzeit formatieren (HH:MM)
        function getCurrentTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        // Tracking für letzte Bot-Nachricht Zeit
        let lastBotMessageTime = null;
        let lastBotMessageElement = null;

        // Hilfsfunktion: Markiert vorherige Bot-Nachricht als Teil einer Gruppe
        function markPreviousBotAsGrouped() {
            if (lastBotMessageElement) {
                lastBotMessageElement.classList.add('grouped-previous');
            }
        }

        // Bei jedem Laden der Seite neuen Chat starten
        window.addEventListener('load', function() {
            console.log('Seite geladen, initialisiere Chat...');
            displayCurrentDate();
            
            // Chat-Inhalt zurücksetzen - Datum + erste Bot-Nachricht
            const chatMessages = document.getElementById('chatMessages');
            lastBotMessageTime = Date.now();
            chatMessages.innerHTML = `
                <div class="date-divider" id="dateDisplay"></div>

                <div class="message bot">
                    <div class="message-avatar">
                        <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                                <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                                <path d="M 20 25 Q 20 25, 20.8 25.8 L 26 32 Q 26.5 32.5, 27 32 L 32.2 25.8 Q 33 25, 33 25 Z"
                                      fill="white" stroke="white" stroke-width="0"/>
                                <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                                <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
                            </g>
                        </svg>
                    </div>
                    <div>
                        <div class="message-content">
                            Hallo! Wie kann ich Ihnen heute helfen?
                        </div>
                        <div class="message-timestamp">
                            <span>${getCurrentTime()}</span>
                            <span class="feedback-separator">·</span>
                            <div class="feedback-buttons">
                                <button class="feedback-btn" onclick="handleFeedback('up')" title="Hilfreich">
                                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M7 22V11M2 13V20C2 21.1046 2.89543 22 4 22H16.4262C17.907 22 19.1662 20.9197 19.3914 19.4562L20.4683 12.4562C20.7479 10.6389 19.3418 9 17.5032 9H14V4C14 2.89543 13.1046 2 12 2C11.4477 2 11 2.44772 11 3V3.56597C11 3.99187 10.8935 4.40959 10.6912 4.77974L7.34164 10.1478C7.12324 10.5412 6.67028 10.7649 6.19298 10.7138L4.27279 10.5028C3.02479 10.3796 2 11.3667 2 12.6197V13Z"/>
                                    </svg>
                                </button>
                                <button class="feedback-btn" onclick="handleFeedback('down')" title="Nicht hilfreich">
                                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M17 2V13M22 11V4C22 2.89543 21.1046 2 20 2H7.57377C6.09299 2 4.83375 3.08027 4.6086 4.54383L3.53165 11.5438C3.25211 13.3611 4.65821 15 6.49678 15H10V20C10 21.1046 10.8954 22 12 22C12.5523 22 13 21.5523 13 21V20.434C13 20.0081 13.1065 19.5904 13.3088 19.2203L16.6584 13.8522C16.8768 13.4588 17.3297 13.2351 17.807 13.2862L19.7272 13.4972C20.9752 13.6204 22 12.6333 22 11.3803V11Z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Datum setzen
            displayCurrentDate();

            // Speichere Referenz zur ersten Bot-Nachricht
            lastBotMessageElement = chatMessages.querySelector('.message.bot');

            // Loading-Indikator für zweite Nachricht
            setTimeout(() => {
                showTypingIndicator(chatMessages);
                
                // Nach 2 Sekunden Loading die zweite Nachricht zeigen
                setTimeout(() => {
                    removeTypingIndicator(chatMessages);
                    
                    const now = Date.now();
                    const isGrouped = lastBotMessageTime && (now - lastBotMessageTime) < 10000;

                    // Wenn gruppiert, markiere vorherige Bot-Nachricht
                    if (isGrouped) {
                        markPreviousBotAsGrouped();
                    }

                    lastBotMessageTime = now;

                    const quickActionsMsg = document.createElement('div');
                    quickActionsMsg.className = isGrouped ? 'message bot grouped' : 'message bot';
                    quickActionsMsg.innerHTML = `
                        <div class="message-avatar">
                            <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                                    <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                                    <path d="M 20 25 Q 20 25, 20.8 25.8 L 26 32 Q 26.5 32.5, 27 32 L 32.2 25.8 Q 33 25, 33 25 Z"
                                          fill="white" stroke="white" stroke-width="0"/>
                                    <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                                    <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
                                </g>
                            </svg>
                        </div>
                        <div>
                            <div class="message-content">
                                Falls Sie eine der folgenden Aktionen durchführen möchten, können Sie diese einfach anklicken:
                                <div class="quick-actions-message">
                                    <button class="quick-action-chat-btn" onclick="handleQuickActionClick('termin')">
                                        Termin vereinbaren
                                    </button>
                                    <button class="quick-action-chat-btn" onclick="handleQuickActionClick('produkte')">
                                        Übersicht zu Produkten
                                    </button>
                                    <button class="quick-action-chat-btn" onclick="handleQuickActionClick('kontakt')">
                                        Kontakt aufnehmen
                                    </button>
                                </div>
                            </div>
                            <div class="message-timestamp">
                                <span>${getCurrentTime()}</span>
                                <span class="feedback-separator">·</span>
                                <div class="feedback-buttons">
                                    <button class="feedback-btn" onclick="handleFeedback('up')" title="Hilfreich">
                                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M7 22V11M2 13V20C2 21.1046 2.89543 22 4 22H16.4262C17.907 22 19.1662 20.9197 19.3914 19.4562L20.4683 12.4562C20.7479 10.6389 19.3418 9 17.5032 9H14V4C14 2.89543 13.1046 2 12 2C11.4477 2 11 2.44772 11 3V3.56597C11 3.99187 10.8935 4.40959 10.6912 4.77974L7.34164 10.1478C7.12324 10.5412 6.67028 10.7649 6.19298 10.7138L4.27279 10.5028C3.02479 10.3796 2 11.3667 2 12.6197V13Z"/>
                                        </svg>
                                    </button>
                                    <button class="feedback-btn" onclick="handleFeedback('down')" title="Nicht hilfreich">
                                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M17 2V13M22 11V4C22 2.89543 21.1046 2 20 2H7.57377C6.09299 2 4.83375 3.08027 4.6086 4.54383L3.53165 11.5438C3.25211 13.3611 4.65821 15 6.49678 15H10V20C10 21.1046 10.8954 22 12 22C12.5523 22 13 21.5523 13 21V20.434C13 20.0081 13.1065 19.5904 13.3088 19.2203L16.6584 13.8522C16.8768 13.4588 17.3297 13.2351 17.807 13.2862L19.7272 13.4972C20.9752 13.6204 22 12.6333 22 11.3803V11Z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    chatMessages.appendChild(quickActionsMsg);
                    lastBotMessageElement = quickActionsMsg;
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 2000);
            }, 800);
            
            // Textarea Event Listener
            const textarea = document.getElementById('messageInput');
            if (textarea) {
                console.log('Textarea gefunden, füge EventListener hinzu...');
                
                textarea.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        console.log('Enter gedrückt!');
                        sendMessage();
                    }
                });
                
                textarea.addEventListener('input', function() {
                    this.style.height = 'auto';
                    const newHeight = Math.min(this.scrollHeight, 120);
                    this.style.height = newHeight + 'px';
                });
            } else {
                console.error('Textarea nicht gefunden!');
            }
        });

        function showTypingIndicator(chatMessages) {
            const now = Date.now();
            const isGrouped = lastBotMessageTime && (now - lastBotMessageTime) < 10000;

            const typingDiv = document.createElement('div');
            typingDiv.className = isGrouped ? 'message bot grouped' : 'message bot';
            typingDiv.id = 'typing-indicator';
            typingDiv.innerHTML = `
                <div class="message-avatar">
                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                            <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                            <path d="M 20 25 Q 20 25, 20.8 25.8 L 26 32 Q 26.5 32.5, 27 32 L 32.2 25.8 Q 33 25, 33 25 Z"
                                  fill="white" stroke="white" stroke-width="0"/>
                            <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                            <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
                        </g>
                    </svg>
                </div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTypingIndicator(chatMessages) {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.classList.add('fade-out');
                setTimeout(() => {
                    indicator.remove();
                }, 300); // Match fadeOut animation duration
            }
        }

        // Neue Funktion: Transformiert Typing Indicator nahtlos in Bot-Nachricht
        function transformTypingIndicatorToMessage(messageContentHTML, isGrouped, callback) {
            const indicator = document.getElementById('typing-indicator');
            if (!indicator) return;

            const messageContent = indicator.querySelector('.message-content');
            if (!messageContent) return;

            // 1. Fade out des Typing-Indikators Content
            messageContent.style.transition = 'opacity 0.2s ease, transform 0.2s ease';
            messageContent.style.opacity = '0';
            messageContent.style.transform = 'scale(0.95)';

            setTimeout(() => {
                // 2. Entferne altes message-content und erstelle neue Struktur
                const avatar = indicator.querySelector('.message-avatar');

                // Erstelle neuen wrapper mit korrekter Struktur
                const wrapper = document.createElement('div');
                wrapper.innerHTML = `
                    <div class="message-content" style="opacity: 0; transform: scale(0.95); transition: opacity 0.3s ease, transform 0.3s ease;">
                        ${messageContentHTML}
                    </div>
                    <div class="message-timestamp">
                        <span>${getCurrentTime()}</span>
                        <span class="feedback-separator">·</span>
                        <div class="feedback-buttons">
                            <button class="feedback-btn" onclick="handleFeedback('up')" title="Hilfreich">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M7 22V11M2 13V20C2 21.1046 2.89543 22 4 22H16.4262C17.907 22 19.1662 20.9197 19.3914 19.4562L20.4683 12.4562C20.7479 10.6389 19.3418 9 17.5032 9H14V4C14 2.89543 13.1046 2 12 2C11.4477 2 11 2.44772 11 3V3.56597C11 3.99187 10.8935 4.40959 10.6912 4.77974L7.34164 10.1478C7.12324 10.5412 6.67028 10.7649 6.19298 10.7138L4.27279 10.5028C3.02479 10.3796 2 11.3667 2 12.6197V13Z"/>
                                </svg>
                            </button>
                            <button class="feedback-btn" onclick="handleFeedback('down')" title="Nicht hilfreich">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17 2V13M22 11V4C22 2.89543 21.1046 2 20 2H7.57377C6.09299 2 4.83375 3.08027 4.6086 4.54383L3.53165 11.5438C3.25211 13.3611 4.65821 15 6.49678 15H10V20C10 21.1046 10.8954 22 12 22C12.5523 22 13 21.5523 13 21V20.434C13 20.0081 13.1065 19.5904 13.3088 19.2203L16.6584 13.8522C16.8768 13.4588 17.3297 13.2351 17.807 13.2862L19.7272 13.4972C20.9752 13.6204 22 12.6333 22 11.3803V11Z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;

                // 3. Ersetze alte Struktur mit neuer
                messageContent.remove();
                indicator.appendChild(wrapper);

                // 4. Entferne typing-indicator ID und aktualisiere Klassen
                indicator.removeAttribute('id');
                indicator.className = isGrouped ? 'message bot grouped' : 'message bot';

                // 5. Fade in der neuen Nachricht
                const newMessageContent = indicator.querySelector('.message-content');
                if (newMessageContent) {
                    setTimeout(() => {
                        newMessageContent.style.opacity = '1';
                        newMessageContent.style.transform = 'scale(1)';
                    }, 50);
                }

                // 6. Callback für weitere Aktionen
                if (callback) {
                    callback(indicator);
                }
            }, 200); // Warte auf fade-out
        }

        // Variable um zu tracken ob Chat schon geöffnet wurde
        let chatWasOpened = false;
        let userHasWritten = false;

        // Pop-up nach 5 Sekunden anzeigen (nur wenn Chat noch nie geöffnet wurde)
        setTimeout(() => {
            const container = document.getElementById('chatContainer');
            const popup = document.getElementById('popupMessage');
            const badge = document.getElementById('notificationBadge');
            
            // Nur anzeigen wenn Chat NICHT geöffnet ist UND noch nie geöffnet wurde
            if (!container.classList.contains('open') && !chatWasOpened) {
                popup.classList.add('show');
                badge.classList.add('show');
            }
        }, 5000);

        function closePopup() {
            const popup = document.getElementById('popupMessage');
            popup.classList.remove('show');
        }
        
        function toggleChat() {
            const container = document.getElementById('chatContainer');
            const button = document.getElementById('chatButton');
            const popup = document.getElementById('popupMessage');
            const badge = document.getElementById('notificationBadge');
            
            container.classList.toggle('open');
            button.classList.toggle('open');
            
            if (container.classList.contains('open')) {
                popup.classList.remove('show');
                badge.classList.remove('show');
            }
            
            // Puls-Effekt
            button.classList.add('clicked');
            setTimeout(() => {
                button.classList.remove('clicked');
            }, 600);
        }

        function toggleExpand() {
            const container = document.getElementById('chatContainer');
            container.classList.toggle('expanded');
        }

        function selectQuickAction(action) {
            toggleChat();
            console.log('Quick Action:', action);
        }

        function handleFeedback(type) {
            console.log('Feedback:', type);
            // Hier kann später die Feedback-Logik implementiert werden
            // z.B. an Backend senden
        }

        // Validierungsfunktionen
        function validateName(name) {
            return name.trim().length >= 2;
        }

        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function selectAppointment(appointment) {
            console.log('Termin ausgewählt:', appointment);
            const chatMessages = document.getElementById('chatMessages');

            // User-Nachricht unterbricht Bot-Gruppierung
            lastBotMessageTime = null;
            lastBotMessageElement = null;

            // User-Nachricht mit ausgewähltem Termin
            const userMessage = document.createElement('div');
            userMessage.className = 'message user';
            userMessage.innerHTML = `
                <div>
                    <div class="message-content">
                        ${appointment}
                    </div>
                    <div class="message-timestamp">
                        <span>${getCurrentTime()}</span>
                    </div>
                </div>
            `;
            chatMessages.appendChild(userMessage);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Typing-Indikator zeigen
            setTimeout(() => {
                showTypingIndicator(chatMessages);

                setTimeout(() => {
                    removeTypingIndicator(chatMessages);

                    const now = Date.now();
                    const isGrouped = lastBotMessageTime && (now - lastBotMessageTime) < 10000;
                    if (isGrouped) {
                        markPreviousBotAsGrouped();
                    }
                    lastBotMessageTime = now;

                    // Bot-Nachricht mit Buchungsformular
                    const formMessage = document.createElement('div');
                    formMessage.className = isGrouped ? 'message bot grouped' : 'message bot';
                    formMessage.innerHTML = `
                        <div class="message-avatar">
                            <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                                    <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                                    <path d="M 20 25 Q 20 25, 20.8 25.8 L 26 32 Q 26.5 32.5, 27 32 L 32.2 25.8 Q 33 25, 33 25 Z"
                                          fill="white" stroke="white" stroke-width="0"/>
                                    <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                                    <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
                                </g>
                            </svg>
                        </div>
                        <div>
                            <div class="message-content">
                                Perfekt! Bitte geben Sie Ihre Kontaktdaten ein:
                                <div class="booking-form" id="bookingFormContainer">
                                    <input type="text" class="booking-input" id="bookingName" placeholder="Name">
                                    <div class="error-message" id="nameError" style="display: none;">Bitte geben Sie einen gültigen Namen ein (mind. 2 Zeichen)</div>
                                    <input type="email" class="booking-input" id="bookingEmail" placeholder="E-Mail-Adresse">
                                    <div class="error-message" id="emailError" style="display: none;">Bitte geben Sie eine gültige E-Mail-Adresse ein</div>
                                    <div class="privacy-checkbox-wrapper">
                                        <input type="checkbox" class="privacy-checkbox" id="privacyCheckbox">
                                        <label for="privacyCheckbox" class="privacy-checkbox-label">
                                            Ich akzeptiere die <a href="#" onclick="event.preventDefault()">Datenschutzerklärung</a>
                                        </label>
                                    </div>
                                    <div class="error-message" id="privacyError" style="display: none;">Bitte akzeptieren Sie die Datenschutzerklärung</div>
                                    <button class="booking-submit" id="bookingSubmitBtn" onclick="submitBooking('${appointment}')">Termin buchen</button>
                                </div>
                            </div>
                            <div class="message-timestamp">
                                <span>${getCurrentTime()}</span>
                                <span class="feedback-separator">·</span>
                                <div class="feedback-buttons">
                                    <button class="feedback-btn" onclick="handleFeedback('up')" title="Hilfreich">
                                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M7 22V11M2 13V20C2 21.1046 2.89543 22 4 22H16.4262C17.907 22 19.1662 20.9197 19.3914 19.4562L20.4683 12.4562C20.7479 10.6389 19.3418 9 17.5032 9H14V4C14 2.89543 13.1046 2 12 2C11.4477 2 11 2.44772 11 3V3.56597C11 3.99187 10.8935 4.40959 10.6912 4.77974L7.34164 10.1478C7.12324 10.5412 6.67028 10.7649 6.19298 10.7138L4.27279 10.5028C3.02479 10.3796 2 11.3667 2 12.6197V13Z"/>
                                        </svg>
                                    </button>
                                    <button class="feedback-btn" onclick="handleFeedback('down')" title="Nicht hilfreich">
                                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M17 2V13M22 11V4C22 2.89543 21.1046 2 20 2H7.57377C6.09299 2 4.83375 3.08027 4.6086 4.54383L3.53165 11.5438C3.25211 13.3611 4.65821 15 6.49678 15H10V20C10 21.1046 10.8954 22 12 22C12.5523 22 13 21.5523 13 21V20.434C13 20.0081 13.1065 19.5904 13.3088 19.2203L16.6584 13.8522C16.8768 13.4588 17.3297 13.2351 17.807 13.2862L19.7272 13.4972C20.9752 13.6204 22 12.6333 22 11.3803V11Z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    chatMessages.appendChild(formMessage);
                    lastBotMessageElement = formMessage;
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 1500);
            }, 500);
        }

        function submitBooking(appointment) {
            const name = document.getElementById('bookingName').value;
            const email = document.getElementById('bookingEmail').value;
            const nameInput = document.getElementById('bookingName');
            const emailInput = document.getElementById('bookingEmail');
            const privacyCheckbox = document.getElementById('privacyCheckbox');
            const nameError = document.getElementById('nameError');
            const emailError = document.getElementById('emailError');
            const privacyError = document.getElementById('privacyError');

            let isValid = true;

            // Name-Validierung
            if (!validateName(name)) {
                nameInput.classList.add('error');
                nameError.style.display = 'block';
                isValid = false;
            } else {
                nameInput.classList.remove('error');
                nameError.style.display = 'none';
            }

            // Email-Validierung
            if (!validateEmail(email)) {
                emailInput.classList.add('error');
                emailError.style.display = 'block';
                isValid = false;
            } else {
                emailInput.classList.remove('error');
                emailError.style.display = 'none';
            }

            // Privacy-Checkbox-Validierung
            if (!privacyCheckbox.checked) {
                privacyError.style.display = 'block';
                isValid = false;
            } else {
                privacyError.style.display = 'none';
            }

            if (isValid) {
                console.log('Buchung:', { appointment, name, email });

                // Inputs deaktivieren
                nameInput.disabled = true;
                emailInput.disabled = true;
                privacyCheckbox.disabled = true;

                // Submit-Button und Formular animieren
                const submitBtn = document.getElementById('bookingSubmitBtn');
                const formContainer = document.getElementById('bookingFormContainer');

                submitBtn.classList.add('hide');
                formContainer.classList.add('submitted');

                // Bestätigungsnachricht anzeigen
                const chatMessages = document.getElementById('chatMessages');

                setTimeout(() => {
                    showTypingIndicator(chatMessages);

                    setTimeout(() => {
                        removeTypingIndicator(chatMessages);

                        const now = Date.now();
                        const isGrouped = lastBotMessageTime && (now - lastBotMessageTime) < 10000;
                        if (isGrouped) {
                            markPreviousBotAsGrouped();
                        }
                        lastBotMessageTime = now;

                        const confirmMessage = document.createElement('div');
                        confirmMessage.className = isGrouped ? 'message bot grouped' : 'message bot';
                        confirmMessage.innerHTML = `
                            <div class="message-avatar">
                                <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                                        <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                                        <path d="M 20 25 Q 20 25, 20.8 25.8 L 26 32 Q 26.5 32.5, 27 32 L 32.2 25.8 Q 33 25, 33 25 Z"
                                              fill="white" stroke="white" stroke-width="0"/>
                                        <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                                        <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
                                    </g>
                                </svg>
                            </div>
                            <div>
                                <div class="message-content">
                                    Vielen Dank! Ihr Termin wurde erfolgreich gebucht. Sie erhalten eine Bestätigungsmail an <span style="color: #B7483E;">${email}</span>.
                                </div>
                                <div class="message-timestamp">
                                    <span>${getCurrentTime()}</span>
                                    <span class="feedback-separator">·</span>
                                    <div class="feedback-buttons">
                                        <button class="feedback-btn" onclick="handleFeedback('up')" title="Hilfreich">
                                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M7 22V11M2 13V20C2 21.1046 2.89543 22 4 22H16.4262C17.907 22 19.1662 20.9197 19.3914 19.4562L20.4683 12.4562C20.7479 10.6389 19.3418 9 17.5032 9H14V4C14 2.89543 13.1046 2 12 2C11.4477 2 11 2.44772 11 3V3.56597C11 3.99187 10.8935 4.40959 10.6912 4.77974L7.34164 10.1478C7.12324 10.5412 6.67028 10.7649 6.19298 10.7138L4.27279 10.5028C3.02479 10.3796 2 11.3667 2 12.6197V13Z"/>
                                            </svg>
                                        </button>
                                        <button class="feedback-btn" onclick="handleFeedback('down')" title="Nicht hilfreich">
                                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M17 2V13M22 11V4C22 2.89543 21.1046 2 20 2H7.57377C6.09299 2 4.83375 3.08027 4.6086 4.54383L3.53165 11.5438C3.25211 13.3611 4.65821 15 6.49678 15H10V20C10 21.1046 10.8954 22 12 22C12.5523 22 13 21.5523 13 21V20.434C13 20.0081 13.1065 19.5904 13.3088 19.2203L16.6584 13.8522C16.8768 13.4588 17.3297 13.2351 17.807 13.2862L19.7272 13.4972C20.9752 13.6204 22 12.6333 22 11.3803V11Z"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                        chatMessages.appendChild(confirmMessage);
                        lastBotMessageElement = confirmMessage;
                        chatMessages.scrollTop = chatMessages.scrollHeight;

                        // Final Feedback nach Termin-Buchung anzeigen
                        showFinalFeedback();
                    }, 1500);
                }, 500);
            }
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();

            if (message) {
                // User hat geschrieben - Flag setzen
                userHasWritten = true;

                // User-Nachricht unterbricht Bot-Nachrichten-Gruppierung
                lastBotMessageTime = null;
                lastBotMessageElement = null;

                // Nachricht zum Chat hinzufügen
                const chatMessages = document.getElementById('chatMessages');

                // User-Nachricht erstellen
                const userMessage = document.createElement('div');
                userMessage.className = 'message user';
                userMessage.innerHTML = `
                    <div>
                        <div class="message-content">
                            ${message}
                        </div>
                        <div class="message-timestamp">
                            <span>${getCurrentTime()}</span>
                        </div>
                    </div>
                `;

                chatMessages.appendChild(userMessage);

                // Input leeren
                input.value = '';
                input.style.height = 'auto';

                // Zum Ende scrollen
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // Mock: Prüfe auf "termin" und zeige Terminvorschläge
                if (message.toLowerCase().includes('termin')) {
                    setTimeout(() => {
                        showTypingIndicator(chatMessages);

                        setTimeout(() => {
                            removeTypingIndicator(chatMessages);

                            const now = Date.now();
                            const isGrouped = lastBotMessageTime && (now - lastBotMessageTime) < 10000;
                            if (isGrouped) {
                                markPreviousBotAsGrouped();
                            }
                            lastBotMessageTime = now;

                            const appointmentMsg = document.createElement('div');
                            appointmentMsg.className = isGrouped ? 'message bot grouped' : 'message bot';
                            appointmentMsg.innerHTML = `
                                <div class="message-avatar">
                                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                                            <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                                            <path d="M 20 25 Q 20 25, 20.8 25.8 L 26 32 Q 26.5 32.5, 27 32 L 32.2 25.8 Q 33 25, 33 25 Z"
                                                  fill="white" stroke="white" stroke-width="0"/>
                                            <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                                            <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
                                        </g>
                                    </svg>
                                </div>
                                <div>
                                    <div class="message-content">
                                        Gerne! Hier sind drei verfügbare Termine:
                                        <div class="quick-actions-message">
                                            <button class="quick-action-chat-btn" onclick="selectAppointment('Montag, 28.10 · 10:00')">
                                                Montag, 28.10 · 10:00
                                            </button>
                                            <button class="quick-action-chat-btn" onclick="selectAppointment('Mittwoch, 30.10 · 14:30')">
                                                Mittwoch, 30.10 · 14:30
                                            </button>
                                            <button class="quick-action-chat-btn" onclick="selectAppointment('Freitag, 01.11 · 09:00')">
                                                Freitag, 01.11 · 09:00
                                            </button>
                                        </div>
                                    </div>
                                    <div class="message-timestamp">
                                        <span>${getCurrentTime()}</span>
                                        <span class="feedback-separator">·</span>
                                        <div class="feedback-buttons">
                                            <button class="feedback-btn" onclick="handleFeedback('up')" title="Hilfreich">
                                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M7 22V11M2 13V20C2 21.1046 2.89543 22 4 22H16.4262C17.907 22 19.1662 20.9197 19.3914 19.4562L20.4683 12.4562C20.7479 10.6389 19.3418 9 17.5032 9H14V4C14 2.89543 13.1046 2 12 2C11.4477 2 11 2.44772 11 3V3.56597C11 3.99187 10.8935 4.40959 10.6912 4.77974L7.34164 10.1478C7.12324 10.5412 6.67028 10.7649 6.19298 10.7138L4.27279 10.5028C3.02479 10.3796 2 11.3667 2 12.6197V13Z"/>
                                                </svg>
                                            </button>
                                            <button class="feedback-btn" onclick="handleFeedback('down')" title="Nicht hilfreich">
                                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M17 2V13M22 11V4C22 2.89543 21.1046 2 20 2H7.57377C6.09299 2 4.83375 3.08027 4.6086 4.54383L3.53165 11.5438C3.25211 13.3611 4.65821 15 6.49678 15H10V20C10 21.1046 10.8954 22 12 22C12.5523 22 13 21.5523 13 21V20.434C13 20.0081 13.1065 19.5904 13.3088 19.2203L16.6584 13.8522C16.8768 13.4588 17.3297 13.2351 17.807 13.2862L19.7272 13.4972C20.9752 13.6204 22 12.6333 22 11.3803V11Z"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                            chatMessages.appendChild(appointmentMsg);
                            lastBotMessageElement = appointmentMsg;
                            chatMessages.scrollTop = chatMessages.scrollHeight;
                        }, 1500);
                    }, 500);
                }

                // Prüfe auf Trigger-Wörter für Final Feedback
                const feedbackTriggerWords = [
                    'danke', 'dankeschön', 'vielen dank', 'super', 'perfekt',
                    'toll', 'prima', 'geholfen', 'hilft', 'hilfreich',
                    'erledigt', 'reicht', 'passt', 'gut', 'alles klar',
                    'okay', 'ok', 'genug', 'fertig', 'tschüss', 'bis dann',
                    'auf wiedersehen', 'ciao', 'bye', 'danke dir'
                ];

                const messageLower = message.toLowerCase();
                const hasTriggerWord = feedbackTriggerWords.some(word => messageLower.includes(word));

                if (hasTriggerWord) {
                    showFinalFeedback();
                }
            }
        }

        function handleQuickActionClick(action) {
            console.log('Quick Action geklickt:', action);
            const chatMessages = document.getElementById('chatMessages');

            // User-Nachricht unterbricht Bot-Gruppierung
            lastBotMessageTime = null;
            lastBotMessageElement = null;

            if (action === 'kontakt') {
                // User-Nachricht
                const userMessage = document.createElement('div');
                userMessage.className = 'message user';
                userMessage.innerHTML = `
                    <div>
                        <div class="message-content">
                            Kontakt aufnehmen
                        </div>
                        <div class="message-timestamp">
                            <span>${getCurrentTime()}</span>
                        </div>
                    </div>
                `;
                chatMessages.appendChild(userMessage);
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // Typing-Indikator zeigen
                setTimeout(() => {
                    showTypingIndicator(chatMessages);

                    setTimeout(() => {
                        removeTypingIndicator(chatMessages);

                        const now = Date.now();
                        const isGrouped = lastBotMessageTime && (now - lastBotMessageTime) < 10000;
                        if (isGrouped) {
                            markPreviousBotAsGrouped();
                        }
                        lastBotMessageTime = now;

                        // Bot-Nachricht mit Kontakt-Button
                        const contactMessage = document.createElement('div');
                        contactMessage.className = isGrouped ? 'message bot grouped' : 'message bot';
                        contactMessage.innerHTML = `
                            <div class="message-avatar">
                                <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                                        <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                                        <path d="M 20 25 Q 20 25, 20.8 25.8 L 26 32 Q 26.5 32.5, 27 32 L 32.2 25.8 Q 33 25, 33 25 Z"
                                              fill="white" stroke="white" stroke-width="0"/>
                                        <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                                        <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
                                    </g>
                                </svg>
                            </div>
                            <div>
                                <div class="message-content">
                                    Gerne! Unser Team wird sich schnellstmöglich bei Ihnen melden.
                                    <button class="contact-handover-btn" onclick="openContactForm()">
                                        Kontaktformular öffnen
                                        <svg viewBox="0 0 24 24">
                                            <path d="M5 12h14M12 5l7 7-7 7"/>
                                        </svg>
                                    </button>
                                </div>
                                <div class="message-timestamp">
                                    <span>${getCurrentTime()}</span>
                                    <span class="feedback-separator">·</span>
                                    <div class="feedback-buttons">
                                        <button class="feedback-btn" onclick="handleFeedback('up')" title="Hilfreich">
                                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M7 22V11M2 13V20C2 21.1046 2.89543 22 4 22H16.4262C17.907 22 19.1662 20.9197 19.3914 19.4562L20.4683 12.4562C20.7479 10.6389 19.3418 9 17.5032 9H14V4C14 2.89543 13.1046 2 12 2C11.4477 2 11 2.44772 11 3V3.56597C11 3.99187 10.8935 4.40959 10.6912 4.77974L7.34164 10.1478C7.12324 10.5412 6.67028 10.7649 6.19298 10.7138L4.27279 10.5028C3.02479 10.3796 2 11.3667 2 12.6197V13Z"/>
                                            </svg>
                                        </button>
                                        <button class="feedback-btn" onclick="handleFeedback('down')" title="Nicht hilfreich">
                                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M17 2V13M22 11V4C22 2.89543 21.1046 2 20 2H7.57377C6.09299 2 4.83375 3.08027 4.6086 4.54383L3.53165 11.5438C3.25211 13.3611 4.65821 15 6.49678 15H10V20C10 21.1046 10.8954 22 12 22C12.5523 22 13 21.5523 13 21V20.434C13 20.0081 13.1065 19.5904 13.3088 19.2203L16.6584 13.8522C16.8768 13.4588 17.3297 13.2351 17.807 13.2862L19.7272 13.4972C20.9752 13.6204 22 12.6333 22 11.3803V11Z"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                        chatMessages.appendChild(contactMessage);
                        lastBotMessageElement = contactMessage;
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }, 1500);
                }, 500);
            } else if (action === 'termin') {
                // Simuliere typing "termin" und trigger termin flow
                const input = document.getElementById('messageInput');
                input.value = 'termin';
                sendMessage();
            }
        }

        function openContactForm() {
            console.log('Öffne Kontaktformular...');
            const chatContainer = document.getElementById('chatContainer');
            const contactFormContainer = document.getElementById('contactFormContainer');

            // Chat verstecken, Kontaktformular anzeigen
            chatContainer.classList.remove('open');
            contactFormContainer.classList.add('open');
        }

        function closeContactForm() {
            console.log('Schließe Kontaktformular...');
            const chatContainer = document.getElementById('chatContainer');
            const contactFormContainer = document.getElementById('contactFormContainer');

            // Kontaktformular verstecken, Chat anzeigen
            contactFormContainer.classList.remove('open');
            chatContainer.classList.add('open');
        }

        // Tracking ob Feedback bereits angezeigt wurde
        let feedbackShown = false;

        function showFinalFeedback() {
            if (feedbackShown) {
                return; // Feedback nur einmal anzeigen
            }
            feedbackShown = true;

            const chatMessages = document.getElementById('chatMessages');

            setTimeout(() => {
                const feedbackMessage = document.createElement('div');
                feedbackMessage.className = 'feedback-message';
                feedbackMessage.innerHTML = `
                    <div class="feedback-message-title">Wurde Ihr Anliegen erfolgreich gelöst?</div>
                    <div class="feedback-message-subtitle">Sie können trotzdem weiter chatten.</div>
                    <div class="feedback-buttons">
                        <button class="feedback-response-btn" onclick="handleFinalFeedback('yes')">
                            <svg viewBox="0 0 24 24">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                            Ja
                        </button>
                        <button class="feedback-response-btn" onclick="handleFinalFeedback('no')">
                            <svg viewBox="0 0 24 24">
                                <line x1="18" y1="6" x2="6" y2="18"/>
                                <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                            Nein
                        </button>
                    </div>
                `;
                chatMessages.appendChild(feedbackMessage);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000);
        }

        function handleFinalFeedback(response) {
            console.log('Final Feedback:', response);

            const chatMessages = document.getElementById('chatMessages');

            // Feedback-Nachricht mit smooth Animation entfernen
            const feedbackMessage = document.querySelector('.feedback-message');
            if (feedbackMessage) {
                feedbackMessage.classList.add('hiding');
                setTimeout(() => {
                    feedbackMessage.remove();
                }, 400);
            }

            // Typing-Indikator zeigen
            setTimeout(() => {
                showTypingIndicator(chatMessages);

                setTimeout(() => {
                    const now = Date.now();
                    const isGrouped = lastBotMessageTime && (now - lastBotMessageTime) < 10000;
                    if (isGrouped) {
                        markPreviousBotAsGrouped();
                    }
                    lastBotMessageTime = now;

                    // Dankes-Nachricht basierend auf Response
                    const responseText = response === 'yes'
                        ? 'Vielen Dank für Ihr Feedback! Es freut uns, dass wir Ihnen helfen konnten.'
                        : 'Vielen Dank für Ihr Feedback. Unser Team wird sich mit Ihnen in Verbindung setzen, um Ihr Anliegen weiter zu klären.';

                    // Transformiere Typing Indicator nahtlos in Bot-Nachricht
                    transformTypingIndicatorToMessage(responseText, isGrouped, (transformedMessage) => {
                        lastBotMessageElement = transformedMessage;
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    });
                }, 1500);
            }, 500);
        }

        function submitContactForm() {
            const name = document.getElementById('contactName').value;
            const email = document.getElementById('contactEmail').value;
            const message = document.getElementById('contactMessage').value;
            const privacyCheckbox = document.getElementById('contactPrivacyCheckbox');

            const nameInput = document.getElementById('contactName');
            const emailInput = document.getElementById('contactEmail');
            const messageInput = document.getElementById('contactMessage');

            const nameError = document.getElementById('contactNameError');
            const emailError = document.getElementById('contactEmailError');
            const messageError = document.getElementById('contactMessageError');
            const privacyError = document.getElementById('contactPrivacyError');

            let isValid = true;

            // Name-Validierung
            if (!validateName(name)) {
                nameInput.classList.add('error');
                nameError.style.display = 'block';
                isValid = false;
            } else {
                nameInput.classList.remove('error');
                nameError.style.display = 'none';
            }

            // Email-Validierung
            if (!validateEmail(email)) {
                emailInput.classList.add('error');
                emailError.style.display = 'block';
                isValid = false;
            } else {
                emailInput.classList.remove('error');
                emailError.style.display = 'none';
            }

            // Message-Validierung (mind. 10 Zeichen)
            if (message.trim().length < 10) {
                messageInput.classList.add('error');
                messageError.style.display = 'block';
                isValid = false;
            } else {
                messageInput.classList.remove('error');
                messageError.style.display = 'none';
            }

            // Privacy-Checkbox-Validierung
            if (!privacyCheckbox.checked) {
                privacyError.style.display = 'block';
                isValid = false;
            } else {
                privacyError.style.display = 'none';
            }

            if (isValid) {
                console.log('Kontaktformular:', { name, email, message });

                // Inputs deaktivieren
                nameInput.disabled = true;
                emailInput.disabled = true;
                messageInput.disabled = true;
                privacyCheckbox.disabled = true;

                // Submit-Button deaktivieren
                const submitBtn = document.getElementById('contactSubmitBtn');
                submitBtn.disabled = true;
                submitBtn.textContent = 'Gesendet ✓';

                // Nach 2 Sekunden zurück zum Chat mit Bestätigungsnachricht
                setTimeout(() => {
                    closeContactForm();

                    // Formular zurücksetzen
                    setTimeout(() => {
                        nameInput.value = '';
                        emailInput.value = '';
                        messageInput.value = '';
                        privacyCheckbox.checked = false;

                        nameInput.disabled = false;
                        emailInput.disabled = false;
                        messageInput.disabled = false;
                        privacyCheckbox.disabled = false;

                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Nachricht senden';
                    }, 500);

                    // Bestätigungsnachricht im Chat hinzufügen
                    const chatMessages = document.getElementById('chatMessages');

                    setTimeout(() => {
                        showTypingIndicator(chatMessages);

                        setTimeout(() => {
                            removeTypingIndicator(chatMessages);

                            const now = Date.now();
                            const isGrouped = lastBotMessageTime && (now - lastBotMessageTime) < 10000;
                            if (isGrouped) {
                                markPreviousBotAsGrouped();
                            }
                            lastBotMessageTime = now;

                            const confirmMessage = document.createElement('div');
                            confirmMessage.className = isGrouped ? 'message bot grouped' : 'message bot';
                            confirmMessage.innerHTML = `
                                <div class="message-avatar">
                                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                                            <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                                            <path d="M 20 25 Q 20 25, 20.8 25.8 L 26 32 Q 26.5 32.5, 27 32 L 32.2 25.8 Q 33 25, 33 25 Z"
                                                  fill="white" stroke="white" stroke-width="0"/>
                                            <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                                            <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
                                        </g>
                                    </svg>
                                </div>
                                <div>
                                    <div class="message-content">
                                        Vielen Dank für Ihre Nachricht! Unser Team wird sich schnellstmöglich bei Ihnen unter <span style="color: #B7483E;">${email}</span> melden.
                                    </div>
                                    <div class="message-timestamp">
                                        <span>${getCurrentTime()}</span>
                                        <span class="feedback-separator">·</span>
                                        <div class="feedback-buttons">
                                            <button class="feedback-btn" onclick="handleFeedback('up')" title="Hilfreich">
                                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M7 22V11M2 13V20C2 21.1046 2.89543 22 4 22H16.4262C17.907 22 19.1662 20.9197 19.3914 19.4562L20.4683 12.4562C20.7479 10.6389 19.3418 9 17.5032 9H14V4C14 2.89543 13.1046 2 12 2C11.4477 2 11 2.44772 11 3V3.56597C11 3.99187 10.8935 4.40959 10.6912 4.77974L7.34164 10.1478C7.12324 10.5412 6.67028 10.7649 6.19298 10.7138L4.27279 10.5028C3.02479 10.3796 2 11.3667 2 12.6197V13Z"/>
                                                </svg>
                                            </button>
                                            <button class="feedback-btn" onclick="handleFeedback('down')" title="Nicht hilfreich">
                                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M17 2V13M22 11V4C22 2.89543 21.1046 2 20 2H7.57377C6.09299 2 4.83375 3.08027 4.6086 4.54383L3.53165 11.5438C3.25211 13.3611 4.65821 15 6.49678 15H10V20C10 21.1046 10.8954 22 12 22C12.5523 22 13 21.5523 13 21V20.434C13 20.0081 13.1065 19.5904 13.3088 19.2203L16.6584 13.8522C16.8768 13.4588 17.3297 13.2351 17.807 13.2862L19.7272 13.4972C20.9752 13.6204 22 12.6333 22 11.3803V11Z"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                            chatMessages.appendChild(confirmMessage);
                            lastBotMessageElement = confirmMessage;
                            chatMessages.scrollTop = chatMessages.scrollHeight;

                            // "Kontaktformular öffnen" Button verstecken
                            const contactHandoverBtn = document.querySelector('.contact-handover-btn');
                            if (contactHandoverBtn) {
                                contactHandoverBtn.classList.add('hide');
                            }
                        }, 1500);
                    }, 500);
                }, 2000);
            }
        }

        const textarea = document.getElementById('messageInput');
        if (textarea) {
            // Enter-Taste Handler
            textarea.addEventListener('keydown', function(event) {
                if (event.key === 'Enter' && !event.shiftKey) {
                    event.preventDefault();
                    console.log('Enter gedrückt, sende Nachricht...');
                    sendMessage();
                }
            });
            
            // Auto-resize
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                const newHeight = Math.min(this.scrollHeight, 120);
                this.style.height = newHeight + 'px';
            });
        }
    </script>
</body>
</html>