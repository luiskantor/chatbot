<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kantor Lab Chatbot - Automatisch deployt</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            height: 100%;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: transparent;
            min-height: 100vh;
            position: relative;
        }

        /* CHAT WIDGET BUTTON */
        .chat-widget-button {
            position: fixed !important;
            bottom: 24px !important;
            right: 24px !important;
            top: auto !important;
            left: auto !important;
            width: 72px;
            height: 72px;
            background: #B7483E;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(183, 72, 62, 0.25);
            transition: all 0.3s ease;
            z-index: 1000;
            padding-top: 2px;
        }

        .chat-widget-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(183, 72, 62, 0.35);
        }

        .notification-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 16px;
            height: 16px;
            background: #ef4444;
            border: 3px solid #ffffff;
            border-radius: 50%;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease;
        }

        .notification-badge.show {
            opacity: 1;
            transform: scale(1);
            animation: pulseBadge 2s ease-in-out infinite;
        }

        @keyframes pulseBadge {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .chat-icon {
            width: 48px;
            height: 48px;
            transition: all 0.3s ease;
            opacity: 1;
            transform: scale(1) rotate(0deg);
        }

        .chat-widget-button.open .chat-icon {
            opacity: 0;
            transform: scale(0) rotate(90deg);
        }

        .close-icon {
            position: absolute;
            width: 32px;
            height: 32px;
            opacity: 0;
            transform: scale(0) rotate(-90deg);
            transition: all 0.3s ease;
        }

        .chat-widget-button.open .close-icon {
            opacity: 1;
            transform: scale(1) rotate(0deg);
        }

        .close-icon line {
            stroke: white;
            stroke-width: 2.5;
            stroke-linecap: round;
        }

        .chat-widget-button.clicked::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid #B7483E;
            animation: pulseRipple 0.6s ease-out;
        }

        @keyframes pulseRipple {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.8;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0;
            }
        }

        /* POP-UP MESSAGE - KEIN SCHIMMER */
        .popup-message {
            position: fixed !important;
            bottom: 130px !important;
            right: 24px !important;
            top: auto !important;
            left: auto !important;
            width: 320px;
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            padding: 20px;
            padding-bottom: 32px;
            opacity: 0;
            transform: translateY(10px) scale(0.95);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
            z-index: 998;
        }

        .popup-message.show {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: all;
        }

        .popup-arrow {
            position: absolute;
            bottom: -10px;
            right: 24px;
            width: 24px;
            height: 24px;
        }

        .popup-arrow::before {
            content: '';
            position: absolute;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%) rotate(45deg);
            width: 22px;
            height: 22px;
            background: #ffffff;
            border-radius: 0 0 4px 0;
        }

        .popup-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
            color: #9ca3af;
        }

        .popup-close:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .popup-close svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
        }

        .popup-content {
            padding-right: 24px;
        }

        .popup-header {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px;
        }

        .popup-badge {
            font-size: 12px;
            font-weight: 600;
            color: #B7483E;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            filter: brightness(1.1) saturate(1.2);
            text-shadow: 0 0 8px rgba(183, 72, 62, 0.3);
        }

        .spark-icon {
            width: 14px;
            height: 14px;
            filter: drop-shadow(0 0 4px rgba(183, 72, 62, 0.4));
        }

        .popup-title {
            font-size: 16px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 4px;
            line-height: 1.4;
            white-space: nowrap;
        }

        .popup-subtitle {
            font-size: 12px;
            color: #6b7280;
            opacity: 0.7;
            margin-bottom: 20px;
            font-weight: 400;
        }

        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .quick-action-btn {
            background: #f9fafb;
            border: none;
            border-radius: 10px;
            padding: 14px 16px;
            font-size: 13px;
            color: #374151;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            font-weight: 500;
            width: fit-content;
        }

        .quick-action-btn:hover {
            background: #f3f4f6;
            color: #B7483E;
            transform: translateY(-1px);
        }

        /* CHATBOT CONTAINER */
        .chatbot-container {
            position: fixed !important;
            bottom: 130px !important;
            right: 24px !important;
            top: auto !important;
            left: auto !important;
            width: 450px;
            height: 680px;
            background: #ffffff;
            border-radius: 28px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 999;
            transition: height 0.4s cubic-bezier(0.34, 1.56, 0.64, 1),
                        opacity 0.4s cubic-bezier(0.34, 1.56, 0.64, 1),
                        transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            opacity: 0;
            transform: translateY(30px) scale(0.9);
            pointer-events: none;
            visibility: hidden;
        }

        .chatbot-container.open {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: all;
            visibility: visible;
        }

        .chatbot-container.expanded {
            height: 800px;
        }

        .chatbot-header {
            padding: 20px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-container {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: #B7483E;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .status-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: #10b981;
            border: 2.5px solid #ffffff;
            border-radius: 50%;
        }

        .header-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .company-name {
            font-size: 13px;
            font-weight: 500;
            color: #111827;
            opacity: 0.7;
        }

        .chatbot-name {
            font-size: 16px;
            color: #111827;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .icon-button {
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            color: #6b7280;
        }

        .icon-button:hover {
            background: #f3f4f6;
            color: #111827;
        }

        .icon-button svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        /* Nur das Close-Icon (X) soll 24px sein */
        .icon-button:last-child svg {
            width: 24px;
            height: 24px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px 24px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            max-width: 90%;
            position: relative;
        }

        /* Gruppierte Bot-Nachrichten (innerhalb 10 Sek) haben kleineren Abstand */
        .message.bot.grouped {
            margin-top: -8px;
        }

        /* Frühere Nachrichten in einer Gruppe verstecken Avatar und Timestamp */
        .message.bot.grouped-previous .message-avatar {
            visibility: hidden;
        }

        .message.bot.grouped-previous .message-timestamp {
            display: none;
        }

        .message-timestamp {
            font-size: 11px;
            color: #9ca3af;
            opacity: 0.6;
            margin-top: 4px;
            text-align: right;
            font-weight: 400;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .message.bot .message-timestamp {
            text-align: left;
            justify-content: flex-start;
        }

        .message.user .message-timestamp {
            justify-content: flex-end;
        }

        .feedback-buttons {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .feedback-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 2px;
            opacity: 0.5;
            transition: opacity 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .feedback-btn:hover {
            opacity: 1;
        }

        .feedback-btn svg {
            width: 14px;
            height: 14px;
            fill: #9ca3af;
        }

        .feedback-separator {
            color: #9ca3af;
            opacity: 0.6;
            margin: 0 2px;
        }

        .message.user {
            margin-left: auto;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #B7483E;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-bottom: 28px;
        }

        .message-avatar svg {
            width: 18px;
            height: 18px;
        }

        .message.user .message-avatar {
            display: none;
        }

        .message-content {
            background: #f9fafb;
            padding: 14px 16px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.5;
            color: #374151;
        }

        .message.user .message-content {
            background: rgba(183, 72, 62, 0.12);
            color: #7C2F28;
        }

        /* Quick Actions im Chat */
        .quick-actions-message {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 16px;
        }

        .quick-action-chat-btn {
            background: #f3f4f6;
            border: none;
            border-radius: 12px;
            padding: 14px 18px;
            font-size: 13px;
            color: #374151;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            font-weight: 500;
        }

        .quick-action-chat-btn:hover {
            background: #e5e7eb;
            color: #B7483E;
            transform: translateY(-1px);
        }

        /* Booking Form */
        .booking-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 16px;
        }

        .booking-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            background: #ffffff;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .booking-input:focus {
            outline: none;
            border-color: #B7483E;
            box-shadow: 0 0 0 3px rgba(183, 72, 62, 0.1);
        }

        .booking-input.error {
            border-color: #ef4444;
        }

        .booking-submit {
            width: 100%;
            padding: 12px 16px;
            background: #B7483E;
            color: #ffffff;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .booking-submit:hover {
            background: #9d3a32;
            transform: translateY(-1px);
        }

        .booking-submit:active {
            transform: translateY(0);
        }

        .booking-submit:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            font-size: 12px;
            color: #ef4444;
            margin-top: -8px;
        }

        /* Loading Animation */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 8px 12px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #9ca3af;
            animation: typingDot 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingDot {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        .date-divider {
            display: flex;
            align-items: center;
            gap: 12px;
            text-align: center;
            font-size: 11px;
            color: #9ca3af;
            opacity: 0.6;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .date-divider::before,
        .date-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(to right, rgba(156, 163, 175, 0) 0%, rgba(156, 163, 175, 0.6) 50%, rgba(156, 163, 175, 0) 100%);
        }

        .date-divider::before {
            background: linear-gradient(to left, rgba(156, 163, 175, 0.6) 50%, rgba(156, 163, 175, 0) 100%);
        }

        .date-divider::after {
            background: linear-gradient(to right, rgba(156, 163, 175, 0.6) 50%, rgba(156, 163, 175, 0) 100%);
        }

        .chat-input-area {
            padding: 16px 20px;
            background: #ffffff;
        }

        .input-wrapper {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: none;
            background: #f9fafb;
            border-radius: 24px;
            font-size: 14px;
            font-family: inherit;
            resize: none;
            min-height: 44px;
            max-height: 120px;
            box-shadow: none;
            transition: box-shadow 0.3s ease;
        }

        .chat-input:hover {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        .chat-input:focus {
            outline: none;
            box-shadow: 0 4px 20px rgba(183, 72, 62, 0.15),
                        0 0 0 3px rgba(183, 72, 62, 0.1);
        }

        .send-button {
            width: 40px;
            height: 40px;
            background: #f9fafb;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .send-button:hover {
            background: #f3f4f6;
            transform: scale(1.05);
        }

        .send-button svg {
            width: 20px;
            height: 20px;
            stroke: #6b7280;
            fill: none;
            stroke-width: 2;
        }

        .privacy-notice {
            font-size: 11px;
            color: #9ca3af;
            text-align: center;
            margin-top: 12px;
        }

        .privacy-notice a {
            color: #B7483E;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <button class="chat-widget-button" id="chatButton" onclick="toggleChat()">
        <div class="notification-badge" id="notificationBadge"></div>
        
        <svg class="chat-icon" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                <path d="M 20 25 Q 20 25, 20.8 25.8 L 26 32 Q 26.5 32.5, 27 32 L 32.2 25.8 Q 33 25, 33 25 Z"
                      fill="white" stroke="white" stroke-width="0"/>
                <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
            </g>
        </svg>
        
        <svg class="close-icon" viewBox="0 0 24 24">
            <line x1="6" y1="6" x2="18" y2="18"/>
            <line x1="18" y1="6" x2="6" y2="18"/>
        </svg>
    </button>

    <div class="popup-message" id="popupMessage">
        <div class="popup-arrow"></div>
        <button class="popup-close" onclick="closePopup()">
            <svg viewBox="0 0 24 24">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        </button>
        <div class="popup-content">
            <div class="popup-header">
                <div class="popup-badge">
                    <svg class="spark-icon" viewBox="0 0 24 24" fill="#B7483E">
                        <path d="M12 2L9 9L2 12L9 15L12 22L15 15L22 12L15 9L12 2Z"/>
                    </svg>
                    Support Assistant
                </div>
            </div>
            <div class="popup-title">Ich helfe Ihnen gerne weiter!</div>
            <div class="popup-subtitle">Wollen Sie möglicherweise?</div>
            <div class="quick-actions">
                <button class="quick-action-btn" onclick="selectQuickAction('termin')">
                    Termin vereinbaren
                </button>
                <button class="quick-action-btn" onclick="selectQuickAction('kontakt')">
                    Ich will Kontakt aufnehmen.
                </button>
                <button class="quick-action-btn" onclick="selectQuickAction('angebot')">
                    Was bietet Ihr genau an?
                </button>
            </div>
        </div>
    </div>

    <div class="chatbot-container" id="chatContainer">
        <div class="chatbot-header">
            <div class="header-left">
                <div class="logo-container">
                    <div class="status-indicator"></div>
                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                            <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                            <path d="M 19 26 Q 19 26, 19.8 26.8 L 24 31 Q 24.5 31.5, 25 31 L 29.2 26.8 Q 30 26, 30 26 Z" 
                                  fill="white" stroke="white" stroke-width="0"/>
                            <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                            <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
                        </g>
                    </svg>
                </div>
                <div class="header-info">
                    <div class="company-name">kantor lab.</div>
                    <div class="chatbot-name">Support Assistant</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="icon-button" onclick="toggleExpand()" title="Erweitern">
                    <svg viewBox="0 0 24 24">
                        <polyline points="15 3 21 3 21 9"/>
                        <polyline points="9 21 3 21 3 15"/>
                        <line x1="21" y1="3" x2="14" y2="10"/>
                        <line x1="3" y1="21" x2="10" y2="14"/>
                    </svg>
                </button>
                <button class="icon-button" onclick="toggleChat()" title="Schließen">
                    <svg viewBox="0 0 24 24">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="date-divider" id="dateDisplay"></div>
            
            <div class="message bot">
                <div class="message-avatar">
                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                            <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                            <path d="M 20 25 Q 20 25, 20.8 25.8 L 26 32 Q 26.5 32.5, 27 32 L 32.2 25.8 Q 33 25, 33 25 Z"
                                  fill="white" stroke="white" stroke-width="0"/>
                            <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                            <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
                        </g>
                    </svg>
                </div>
                <div>
                    <div class="message-content">
                        Hallo! Wie kann ich Ihnen heute helfen?
                    </div>
                </div>
            </div>

            <div class="message user">
                <div>
                    <div class="message-content">
                        Ich möchte einen Termin buchen.
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-input-area">
            <div class="input-wrapper">
                <textarea 
                    id="messageInput" 
                    class="chat-input" 
                    placeholder="Schreiben Sie eine Nachricht..."
                    rows="1"
                ></textarea>
                <button class="send-button" onclick="sendMessage()">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 19V5M5 12l7-7 7 7" stroke="#6b7280" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div class="privacy-notice">
                Mit dem Senden akzeptieren Sie unsere <a href="#">Datenschutz</a>
            </div>
        </div>
    </div>

    <script>
        // Aktuelles Datum anzeigen (ohne Jahr)
        function displayCurrentDate() {
            const dateDiv = document.getElementById('dateDisplay');
            const today = new Date();
            const options = { weekday: 'long', month: 'long', day: 'numeric' };
            const dateString = today.toLocaleDateString('de-DE', options);
            dateDiv.textContent = dateString;
        }

        // Uhrzeit formatieren (HH:MM)
        function getCurrentTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        // Tracking für letzte Bot-Nachricht Zeit
        let lastBotMessageTime = null;
        let lastBotMessageElement = null;

        // Hilfsfunktion: Markiert vorherige Bot-Nachricht als Teil einer Gruppe
        function markPreviousBotAsGrouped() {
            if (lastBotMessageElement) {
                lastBotMessageElement.classList.add('grouped-previous');
            }
        }

        // Bei jedem Laden der Seite neuen Chat starten
        window.addEventListener('load', function() {
            console.log('Seite geladen, initialisiere Chat...');
            displayCurrentDate();
            
            // Chat-Inhalt zurücksetzen - Datum + erste Bot-Nachricht
            const chatMessages = document.getElementById('chatMessages');
            lastBotMessageTime = Date.now();
            chatMessages.innerHTML = `
                <div class="date-divider" id="dateDisplay"></div>

                <div class="message bot">
                    <div class="message-avatar">
                        <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                                <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                                <path d="M 20 25 Q 20 25, 20.8 25.8 L 26 32 Q 26.5 32.5, 27 32 L 32.2 25.8 Q 33 25, 33 25 Z"
                                      fill="white" stroke="white" stroke-width="0"/>
                                <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                                <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
                            </g>
                        </svg>
                    </div>
                    <div>
                        <div class="message-content">
                            Hallo! Wie kann ich Ihnen heute helfen?
                        </div>
                        <div class="message-timestamp">
                            <span>${getCurrentTime()}</span>
                            <span class="feedback-separator">·</span>
                            <div class="feedback-buttons">
                                <button class="feedback-btn" onclick="handleFeedback('up')" title="Hilfreich">
                                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M7 22V11M2 13V20C2 21.1046 2.89543 22 4 22H16.4262C17.907 22 19.1662 20.9197 19.3914 19.4562L20.4683 12.4562C20.7479 10.6389 19.3418 9 17.5032 9H14V4C14 2.89543 13.1046 2 12 2C11.4477 2 11 2.44772 11 3V3.56597C11 3.99187 10.8935 4.40959 10.6912 4.77974L7.34164 10.1478C7.12324 10.5412 6.67028 10.7649 6.19298 10.7138L4.27279 10.5028C3.02479 10.3796 2 11.3667 2 12.6197V13Z"/>
                                    </svg>
                                </button>
                                <button class="feedback-btn" onclick="handleFeedback('down')" title="Nicht hilfreich">
                                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M17 2V13M22 11V4C22 2.89543 21.1046 2 20 2H7.57377C6.09299 2 4.83375 3.08027 4.6086 4.54383L3.53165 11.5438C3.25211 13.3611 4.65821 15 6.49678 15H10V20C10 21.1046 10.8954 22 12 22C12.5523 22 13 21.5523 13 21V20.434C13 20.0081 13.1065 19.5904 13.3088 19.2203L16.6584 13.8522C16.8768 13.4588 17.3297 13.2351 17.807 13.2862L19.7272 13.4972C20.9752 13.6204 22 12.6333 22 11.3803V11Z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Datum setzen
            displayCurrentDate();

            // Speichere Referenz zur ersten Bot-Nachricht
            lastBotMessageElement = chatMessages.querySelector('.message.bot');

            // Loading-Indikator für zweite Nachricht
            setTimeout(() => {
                showTypingIndicator(chatMessages);
                
                // Nach 2 Sekunden Loading die zweite Nachricht zeigen
                setTimeout(() => {
                    removeTypingIndicator(chatMessages);
                    
                    const now = Date.now();
                    const isGrouped = lastBotMessageTime && (now - lastBotMessageTime) < 10000;

                    // Wenn gruppiert, markiere vorherige Bot-Nachricht
                    if (isGrouped) {
                        markPreviousBotAsGrouped();
                    }

                    lastBotMessageTime = now;

                    const quickActionsMsg = document.createElement('div');
                    quickActionsMsg.className = isGrouped ? 'message bot grouped' : 'message bot';
                    quickActionsMsg.innerHTML = `
                        <div class="message-avatar">
                            <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                                    <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                                    <path d="M 20 25 Q 20 25, 20.8 25.8 L 26 32 Q 26.5 32.5, 27 32 L 32.2 25.8 Q 33 25, 33 25 Z"
                                          fill="white" stroke="white" stroke-width="0"/>
                                    <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                                    <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
                                </g>
                            </svg>
                        </div>
                        <div>
                            <div class="message-content">
                                Falls Sie eine der folgenden Aktionen durchführen möchten, können Sie diese einfach anklicken:
                                <div class="quick-actions-message">
                                    <button class="quick-action-chat-btn" onclick="handleQuickActionClick('termin')">
                                        Termin vereinbaren
                                    </button>
                                    <button class="quick-action-chat-btn" onclick="handleQuickActionClick('produkte')">
                                        Übersicht zu Produkten
                                    </button>
                                    <button class="quick-action-chat-btn" onclick="handleQuickActionClick('kontakt')">
                                        Kontakt aufnehmen
                                    </button>
                                </div>
                            </div>
                            <div class="message-timestamp">
                                <span>${getCurrentTime()}</span>
                                <span class="feedback-separator">·</span>
                                <div class="feedback-buttons">
                                    <button class="feedback-btn" onclick="handleFeedback('up')" title="Hilfreich">
                                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M7 22V11M2 13V20C2 21.1046 2.89543 22 4 22H16.4262C17.907 22 19.1662 20.9197 19.3914 19.4562L20.4683 12.4562C20.7479 10.6389 19.3418 9 17.5032 9H14V4C14 2.89543 13.1046 2 12 2C11.4477 2 11 2.44772 11 3V3.56597C11 3.99187 10.8935 4.40959 10.6912 4.77974L7.34164 10.1478C7.12324 10.5412 6.67028 10.7649 6.19298 10.7138L4.27279 10.5028C3.02479 10.3796 2 11.3667 2 12.6197V13Z"/>
                                        </svg>
                                    </button>
                                    <button class="feedback-btn" onclick="handleFeedback('down')" title="Nicht hilfreich">
                                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M17 2V13M22 11V4C22 2.89543 21.1046 2 20 2H7.57377C6.09299 2 4.83375 3.08027 4.6086 4.54383L3.53165 11.5438C3.25211 13.3611 4.65821 15 6.49678 15H10V20C10 21.1046 10.8954 22 12 22C12.5523 22 13 21.5523 13 21V20.434C13 20.0081 13.1065 19.5904 13.3088 19.2203L16.6584 13.8522C16.8768 13.4588 17.3297 13.2351 17.807 13.2862L19.7272 13.4972C20.9752 13.6204 22 12.6333 22 11.3803V11Z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    chatMessages.appendChild(quickActionsMsg);
                    lastBotMessageElement = quickActionsMsg;
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 2000);
            }, 800);
            
            // Textarea Event Listener
            const textarea = document.getElementById('messageInput');
            if (textarea) {
                console.log('Textarea gefunden, füge EventListener hinzu...');
                
                textarea.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        console.log('Enter gedrückt!');
                        sendMessage();
                    }
                });
                
                textarea.addEventListener('input', function() {
                    this.style.height = 'auto';
                    const newHeight = Math.min(this.scrollHeight, 120);
                    this.style.height = newHeight + 'px';
                });
            } else {
                console.error('Textarea nicht gefunden!');
            }
        });

        function showTypingIndicator(chatMessages) {
            const now = Date.now();
            const isGrouped = lastBotMessageTime && (now - lastBotMessageTime) < 10000;

            const typingDiv = document.createElement('div');
            typingDiv.className = isGrouped ? 'message bot grouped' : 'message bot';
            typingDiv.id = 'typing-indicator';
            typingDiv.innerHTML = `
                <div class="message-avatar">
                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                            <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                            <path d="M 20 25 Q 20 25, 20.8 25.8 L 26 32 Q 26.5 32.5, 27 32 L 32.2 25.8 Q 33 25, 33 25 Z"
                                  fill="white" stroke="white" stroke-width="0"/>
                            <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                            <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
                        </g>
                    </svg>
                </div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTypingIndicator(chatMessages) {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // Variable um zu tracken ob Chat schon geöffnet wurde
        let chatWasOpened = false;
        let userHasWritten = false;

        // Pop-up nach 5 Sekunden anzeigen (nur wenn Chat noch nie geöffnet wurde)
        setTimeout(() => {
            const container = document.getElementById('chatContainer');
            const popup = document.getElementById('popupMessage');
            const badge = document.getElementById('notificationBadge');
            
            // Nur anzeigen wenn Chat NICHT geöffnet ist UND noch nie geöffnet wurde
            if (!container.classList.contains('open') && !chatWasOpened) {
                popup.classList.add('show');
                badge.classList.add('show');
            }
        }, 5000);

        function closePopup() {
            const popup = document.getElementById('popupMessage');
            popup.classList.remove('show');
        }
        
        function toggleChat() {
            const container = document.getElementById('chatContainer');
            const button = document.getElementById('chatButton');
            const popup = document.getElementById('popupMessage');
            const badge = document.getElementById('notificationBadge');
            
            container.classList.toggle('open');
            button.classList.toggle('open');
            
            if (container.classList.contains('open')) {
                popup.classList.remove('show');
                badge.classList.remove('show');
            }
            
            // Puls-Effekt
            button.classList.add('clicked');
            setTimeout(() => {
                button.classList.remove('clicked');
            }, 600);
        }

        function toggleExpand() {
            const container = document.getElementById('chatContainer');
            container.classList.toggle('expanded');
        }

        function selectQuickAction(action) {
            toggleChat();
            console.log('Quick Action:', action);
        }

        function handleFeedback(type) {
            console.log('Feedback:', type);
            // Hier kann später die Feedback-Logik implementiert werden
            // z.B. an Backend senden
        }

        // Validierungsfunktionen
        function validateName(name) {
            return name.trim().length >= 2;
        }

        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function selectAppointment(appointment) {
            console.log('Termin ausgewählt:', appointment);
            const chatMessages = document.getElementById('chatMessages');

            // User-Nachricht unterbricht Bot-Gruppierung
            lastBotMessageTime = null;
            lastBotMessageElement = null;

            // User-Nachricht mit ausgewähltem Termin
            const userMessage = document.createElement('div');
            userMessage.className = 'message user';
            userMessage.innerHTML = `
                <div>
                    <div class="message-content">
                        ${appointment}
                    </div>
                    <div class="message-timestamp">
                        <span>${getCurrentTime()}</span>
                    </div>
                </div>
            `;
            chatMessages.appendChild(userMessage);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Typing-Indikator zeigen
            setTimeout(() => {
                showTypingIndicator(chatMessages);

                setTimeout(() => {
                    removeTypingIndicator(chatMessages);

                    const now = Date.now();
                    const isGrouped = lastBotMessageTime && (now - lastBotMessageTime) < 10000;
                    if (isGrouped) {
                        markPreviousBotAsGrouped();
                    }
                    lastBotMessageTime = now;

                    // Bot-Nachricht mit Buchungsformular
                    const formMessage = document.createElement('div');
                    formMessage.className = isGrouped ? 'message bot grouped' : 'message bot';
                    formMessage.innerHTML = `
                        <div class="message-avatar">
                            <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                                    <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                                    <path d="M 20 25 Q 20 25, 20.8 25.8 L 26 32 Q 26.5 32.5, 27 32 L 32.2 25.8 Q 33 25, 33 25 Z"
                                          fill="white" stroke="white" stroke-width="0"/>
                                    <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                                    <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
                                </g>
                            </svg>
                        </div>
                        <div>
                            <div class="message-content">
                                Perfekt! Bitte geben Sie Ihre Kontaktdaten ein:
                                <div class="booking-form">
                                    <input type="text" class="booking-input" id="bookingName" placeholder="Name">
                                    <div class="error-message" id="nameError" style="display: none;">Bitte geben Sie einen gültigen Namen ein (mind. 2 Zeichen)</div>
                                    <input type="email" class="booking-input" id="bookingEmail" placeholder="E-Mail-Adresse">
                                    <div class="error-message" id="emailError" style="display: none;">Bitte geben Sie eine gültige E-Mail-Adresse ein</div>
                                    <button class="booking-submit" onclick="submitBooking('${appointment}')">Termin buchen</button>
                                </div>
                            </div>
                            <div class="message-timestamp">
                                <span>${getCurrentTime()}</span>
                                <span class="feedback-separator">·</span>
                                <div class="feedback-buttons">
                                    <button class="feedback-btn" onclick="handleFeedback('up')" title="Hilfreich">
                                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M7 22V11M2 13V20C2 21.1046 2.89543 22 4 22H16.4262C17.907 22 19.1662 20.9197 19.3914 19.4562L20.4683 12.4562C20.7479 10.6389 19.3418 9 17.5032 9H14V4C14 2.89543 13.1046 2 12 2C11.4477 2 11 2.44772 11 3V3.56597C11 3.99187 10.8935 4.40959 10.6912 4.77974L7.34164 10.1478C7.12324 10.5412 6.67028 10.7649 6.19298 10.7138L4.27279 10.5028C3.02479 10.3796 2 11.3667 2 12.6197V13Z"/>
                                        </svg>
                                    </button>
                                    <button class="feedback-btn" onclick="handleFeedback('down')" title="Nicht hilfreich">
                                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M17 2V13M22 11V4C22 2.89543 21.1046 2 20 2H7.57377C6.09299 2 4.83375 3.08027 4.6086 4.54383L3.53165 11.5438C3.25211 13.3611 4.65821 15 6.49678 15H10V20C10 21.1046 10.8954 22 12 22C12.5523 22 13 21.5523 13 21V20.434C13 20.0081 13.1065 19.5904 13.3088 19.2203L16.6584 13.8522C16.8768 13.4588 17.3297 13.2351 17.807 13.2862L19.7272 13.4972C20.9752 13.6204 22 12.6333 22 11.3803V11Z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    chatMessages.appendChild(formMessage);
                    lastBotMessageElement = formMessage;
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 1500);
            }, 500);
        }

        function submitBooking(appointment) {
            const name = document.getElementById('bookingName').value;
            const email = document.getElementById('bookingEmail').value;
            const nameInput = document.getElementById('bookingName');
            const emailInput = document.getElementById('bookingEmail');
            const nameError = document.getElementById('nameError');
            const emailError = document.getElementById('emailError');

            let isValid = true;

            // Name-Validierung
            if (!validateName(name)) {
                nameInput.classList.add('error');
                nameError.style.display = 'block';
                isValid = false;
            } else {
                nameInput.classList.remove('error');
                nameError.style.display = 'none';
            }

            // Email-Validierung
            if (!validateEmail(email)) {
                emailInput.classList.add('error');
                emailError.style.display = 'block';
                isValid = false;
            } else {
                emailInput.classList.remove('error');
                emailError.style.display = 'none';
            }

            if (isValid) {
                console.log('Buchung:', { appointment, name, email });
                // Hier kann später die Backend-Integration erfolgen

                // Bestätigungsnachricht anzeigen
                const chatMessages = document.getElementById('chatMessages');

                setTimeout(() => {
                    showTypingIndicator(chatMessages);

                    setTimeout(() => {
                        removeTypingIndicator(chatMessages);

                        const now = Date.now();
                        const isGrouped = lastBotMessageTime && (now - lastBotMessageTime) < 10000;
                        if (isGrouped) {
                            markPreviousBotAsGrouped();
                        }
                        lastBotMessageTime = now;

                        const confirmMessage = document.createElement('div');
                        confirmMessage.className = isGrouped ? 'message bot grouped' : 'message bot';
                        confirmMessage.innerHTML = `
                            <div class="message-avatar">
                                <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                                        <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                                        <path d="M 20 25 Q 20 25, 20.8 25.8 L 26 32 Q 26.5 32.5, 27 32 L 32.2 25.8 Q 33 25, 33 25 Z"
                                              fill="white" stroke="white" stroke-width="0"/>
                                        <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                                        <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
                                    </g>
                                </svg>
                            </div>
                            <div>
                                <div class="message-content">
                                    Vielen Dank! Ihr Termin wurde erfolgreich gebucht. Sie erhalten eine Bestätigungsmail an ${email}.
                                </div>
                                <div class="message-timestamp">
                                    <span>${getCurrentTime()}</span>
                                    <span class="feedback-separator">·</span>
                                    <div class="feedback-buttons">
                                        <button class="feedback-btn" onclick="handleFeedback('up')" title="Hilfreich">
                                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M7 22V11M2 13V20C2 21.1046 2.89543 22 4 22H16.4262C17.907 22 19.1662 20.9197 19.3914 19.4562L20.4683 12.4562C20.7479 10.6389 19.3418 9 17.5032 9H14V4C14 2.89543 13.1046 2 12 2C11.4477 2 11 2.44772 11 3V3.56597C11 3.99187 10.8935 4.40959 10.6912 4.77974L7.34164 10.1478C7.12324 10.5412 6.67028 10.7649 6.19298 10.7138L4.27279 10.5028C3.02479 10.3796 2 11.3667 2 12.6197V13Z"/>
                                            </svg>
                                        </button>
                                        <button class="feedback-btn" onclick="handleFeedback('down')" title="Nicht hilfreich">
                                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M17 2V13M22 11V4C22 2.89543 21.1046 2 20 2H7.57377C6.09299 2 4.83375 3.08027 4.6086 4.54383L3.53165 11.5438C3.25211 13.3611 4.65821 15 6.49678 15H10V20C10 21.1046 10.8954 22 12 22C12.5523 22 13 21.5523 13 21V20.434C13 20.0081 13.1065 19.5904 13.3088 19.2203L16.6584 13.8522C16.8768 13.4588 17.3297 13.2351 17.807 13.2862L19.7272 13.4972C20.9752 13.6204 22 12.6333 22 11.3803V11Z"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                        chatMessages.appendChild(confirmMessage);
                        lastBotMessageElement = confirmMessage;
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }, 1500);
                }, 500);
            }
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();

            if (message) {
                // User hat geschrieben - Flag setzen
                userHasWritten = true;

                // User-Nachricht unterbricht Bot-Nachrichten-Gruppierung
                lastBotMessageTime = null;
                lastBotMessageElement = null;

                // Nachricht zum Chat hinzufügen
                const chatMessages = document.getElementById('chatMessages');

                // User-Nachricht erstellen
                const userMessage = document.createElement('div');
                userMessage.className = 'message user';
                userMessage.innerHTML = `
                    <div>
                        <div class="message-content">
                            ${message}
                        </div>
                        <div class="message-timestamp">
                            <span>${getCurrentTime()}</span>
                        </div>
                    </div>
                `;

                chatMessages.appendChild(userMessage);

                // Input leeren
                input.value = '';
                input.style.height = 'auto';

                // Zum Ende scrollen
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // Mock: Prüfe auf "termin" und zeige Terminvorschläge
                if (message.toLowerCase().includes('termin')) {
                    setTimeout(() => {
                        showTypingIndicator(chatMessages);

                        setTimeout(() => {
                            removeTypingIndicator(chatMessages);

                            const now = Date.now();
                            const isGrouped = lastBotMessageTime && (now - lastBotMessageTime) < 10000;
                            if (isGrouped) {
                                markPreviousBotAsGrouped();
                            }
                            lastBotMessageTime = now;

                            const appointmentMsg = document.createElement('div');
                            appointmentMsg.className = isGrouped ? 'message bot grouped' : 'message bot';
                            appointmentMsg.innerHTML = `
                                <div class="message-avatar">
                                    <svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g transform="translate(25, 25) rotate(2) translate(-25, -25) translate(4, 12)">
                                            <rect x="0" y="0" width="42" height="26" rx="2.5" fill="white"/>
                                            <path d="M 20 25 Q 20 25, 20.8 25.8 L 26 32 Q 26.5 32.5, 27 32 L 32.2 25.8 Q 33 25, 33 25 Z"
                                                  fill="white" stroke="white" stroke-width="0"/>
                                            <ellipse cx="13" cy="16" rx="2.8" ry="2.8" fill="#B7483E"/>
                                            <ellipse cx="20" cy="17" rx="2.8" ry="2.8" fill="#B7483E"/>
                                        </g>
                                    </svg>
                                </div>
                                <div>
                                    <div class="message-content">
                                        Gerne! Hier sind drei verfügbare Termine:
                                        <div class="quick-actions-message">
                                            <button class="quick-action-chat-btn" onclick="selectAppointment('Montag, 28.10 · 10:00')">
                                                Montag, 28.10 · 10:00
                                            </button>
                                            <button class="quick-action-chat-btn" onclick="selectAppointment('Mittwoch, 30.10 · 14:30')">
                                                Mittwoch, 30.10 · 14:30
                                            </button>
                                            <button class="quick-action-chat-btn" onclick="selectAppointment('Freitag, 01.11 · 09:00')">
                                                Freitag, 01.11 · 09:00
                                            </button>
                                        </div>
                                    </div>
                                    <div class="message-timestamp">
                                        <span>${getCurrentTime()}</span>
                                        <span class="feedback-separator">·</span>
                                        <div class="feedback-buttons">
                                            <button class="feedback-btn" onclick="handleFeedback('up')" title="Hilfreich">
                                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M7 22V11M2 13V20C2 21.1046 2.89543 22 4 22H16.4262C17.907 22 19.1662 20.9197 19.3914 19.4562L20.4683 12.4562C20.7479 10.6389 19.3418 9 17.5032 9H14V4C14 2.89543 13.1046 2 12 2C11.4477 2 11 2.44772 11 3V3.56597C11 3.99187 10.8935 4.40959 10.6912 4.77974L7.34164 10.1478C7.12324 10.5412 6.67028 10.7649 6.19298 10.7138L4.27279 10.5028C3.02479 10.3796 2 11.3667 2 12.6197V13Z"/>
                                                </svg>
                                            </button>
                                            <button class="feedback-btn" onclick="handleFeedback('down')" title="Nicht hilfreich">
                                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M17 2V13M22 11V4C22 2.89543 21.1046 2 20 2H7.57377C6.09299 2 4.83375 3.08027 4.6086 4.54383L3.53165 11.5438C3.25211 13.3611 4.65821 15 6.49678 15H10V20C10 21.1046 10.8954 22 12 22C12.5523 22 13 21.5523 13 21V20.434C13 20.0081 13.1065 19.5904 13.3088 19.2203L16.6584 13.8522C16.8768 13.4588 17.3297 13.2351 17.807 13.2862L19.7272 13.4972C20.9752 13.6204 22 12.6333 22 11.3803V11Z"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                            chatMessages.appendChild(appointmentMsg);
                            lastBotMessageElement = appointmentMsg;
                            chatMessages.scrollTop = chatMessages.scrollHeight;
                        }, 1500);
                    }, 500);
                }
            }
        }

        const textarea = document.getElementById('messageInput');
        if (textarea) {
            // Enter-Taste Handler
            textarea.addEventListener('keydown', function(event) {
                if (event.key === 'Enter' && !event.shiftKey) {
                    event.preventDefault();
                    console.log('Enter gedrückt, sende Nachricht...');
                    sendMessage();
                }
            });
            
            // Auto-resize
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                const newHeight = Math.min(this.scrollHeight, 120);
                this.style.height = newHeight + 'px';
            });
        }
    </script>
</body>
</html>